<!DOCTYPE html>
<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>The Toss Arena - Binary</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
<script src="tailwind.js"></script>
<script>
    function initTailwind() {
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            primary: "#4F46E5", // Indigo-600
                            "background-light": "#F8FAFC",
                            "background-dark": "#0F172A",
                            "binary-green": "#22C55E",
                        },
                        fontFamily: {
                            display: ["Space Grotesk", "sans-serif"],
                            sans: ["Inter", "sans-serif"],
                        },
                        borderRadius: {
                            DEFAULT: "1rem",
                        },
                    },
                },
            };
        } else {
            setTimeout(initTailwind, 50);
        }
    }
    initTailwind();
</script>
<style>
        .coin-container {
            perspective: 1000px;
            width: 240px;
            height: 240px;
        }
        .coin {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 3s cubic-bezier(0.1, 0.8, 0.2, 1);
        }
        .coin-side {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 8px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 40px rgba(0,0,0,0.3), inset 0 0 20px rgba(255,255,255,0.2);
        }
        .coin-front {
            background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%);}
        .coin-back {
            background: linear-gradient(135deg, #f43f5e 0%, #be123c 100%);transform: rotateY(180deg);
        }
        .coin.flipping {
            animation: flipContinuous 0.6s linear infinite;
        }
        @keyframes flipContinuous {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        .glow-effect {
            filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.5));
        }.glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .ios-bottom-bar {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white font-sans overflow-hidden h-screen flex flex-col">
<header class="pt-12 px-6 flex justify-between items-center">
<button class="w-10 h-10 rounded-full flex items-center justify-center bg-slate-200 dark:bg-slate-800">
<span class="material-icons-round text-xl">arrow_back_ios_new</span>
</button>
<div class="flex items-center gap-2">
<span class="font-display text-2xl font-bold tracking-tighter">B<span class="text-binary-green glow-effect italic">i</span>NARY</span>
</div>
<button class="w-10 h-10 rounded-full flex items-center justify-center bg-slate-200 dark:bg-slate-800">
<span class="material-icons-round text-xl">help_outline</span>
</button>
</header>
<main class="flex-1 flex flex-col items-center justify-center px-6 relative">
<div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-72 h-72 bg-primary/20 blur-[100px] rounded-full -z-10"></div>
<div class="text-center mb-12">
<h1 class="text-3xl font-display font-bold mb-2">The Toss Arena</h1>
<p class="text-slate-500 dark:text-slate-400 font-medium" id="status-text">Fate decides who leads.</p>
</div>
<div class="coin-container" id="coin-trigger">
<div class="coin" id="coin">
<div class="coin-side coin-front">
<div class="flex flex-col items-center">
<span class="material-icons-round text-7xl text-white mb-2">person</span>
<span id="p1-name" class="text-white font-display font-bold text-xl uppercase tracking-widest">Player 1</span>
</div>
</div>
<div class="coin-side coin-back">
<div class="flex flex-col items-center">
<span class="material-icons-round text-7xl text-white mb-2">person_outline</span>
<span id="p2-name" class="text-white font-display font-bold text-xl uppercase tracking-widest">Player 2</span>
</div>
</div>
</div>
</div>
<div class="mt-12 opacity-0 transition-opacity duration-500 scale-95 transform" id="result-container">
<div class="glass-card rounded-2xl px-8 py-4 flex items-center gap-4">
<div class="w-4 h-4 rounded-full" id="winner-indicator"></div>
<p class="text-lg font-semibold" id="result-text"></p>
</div>
</div>
</main>
<footer class="px-6 pb-12 ios-bottom-bar flex flex-col gap-4">
<button class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-display font-bold py-5 rounded-2xl text-xl shadow-lg shadow-indigo-500/30 transition-all active:scale-95 flex items-center justify-center gap-2" id="flip-button">
<span class="material-icons-round">autorenew</span>
            FLIP COIN
        </button>
<div class="flex justify-between items-center px-4">
<div class="flex items-center gap-2 opacity-60">
<div class="w-3 h-3 rounded-full bg-sky-500"></div>
<span id="p1-footer" class="text-xs font-bold uppercase tracking-wider">Alex</span>
</div>
<div class="h-px flex-1 mx-4 bg-slate-200 dark:bg-slate-800"></div>
<div class="flex items-center gap-2 opacity-60">
<span id="p2-footer" class="text-xs font-bold uppercase tracking-wider">Jordan</span>
<div class="w-3 h-3 rounded-full bg-rose-500"></div>
</div>
</div>
</footer>
    <script src="game.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Safety check for GameEngine
            if (typeof GameEngine === 'undefined') {
                console.error("GameEngine not loaded.");
                alert("Error: Game Engine failed to load.");
                return;
            }

            // Init UI with Names
            const players = GameEngine.getPlayers();
            if (document.getElementById('p1-name')) document.getElementById('p1-name').innerText = players.p1;
            if (document.getElementById('p2-name')) document.getElementById('p2-name').innerText = players.p2;
            if (document.getElementById('p1-footer')) document.getElementById('p1-footer').innerText = players.p1;
            if (document.getElementById('p2-footer')) document.getElementById('p2-footer').innerText = players.p2;

            const flipBtn = document.getElementById('flip-button');
            const coin = document.getElementById('coin');
            const statusText = document.getElementById('status-text');
            const resultContainer = document.getElementById('result-container');
            const resultText = document.getElementById('result-text');
            const winnerIndicator = document.getElementById('winner-indicator');
            let isFlipping = false;
            
            if (!flipBtn || !coin) {
                console.error("Critical elements missing from DOM.");
                return;
            }

            flipBtn.addEventListener('click', startFlip);
            if (coin) coin.addEventListener('click', startFlip);

            function startFlip() {
                if (isFlipping) return;
                
                console.log("Flip initiated...");
                
                // Reset state
                isFlipping = true;
                flipBtn.disabled = true; // Permanently disable for this session
                flipBtn.classList.add('opacity-50', 'cursor-not-allowed');
                
                // Remove click listener from coin
                if (coin) {
                    coin.style.cursor = 'default';
                    coin.onclick = null;
                }
                
                resultContainer.classList.add('opacity-0', 'scale-95');
                statusText.innerText = "The coin is in the air...";
                
                // Random result (0 or 1)
                const winner = Math.floor(Math.random() * 2); 
                console.log("Winner index:", winner);

                // Add a high number of rotations for effect
                // 1800deg = 5 full spins. 
                // If winner is 0 (Player 1/Heads), we end at a multiple of 360 (e.g., 1800).
                // If winner is 1 (Player 2/Tails), we end at 1800 + 180.
                const rotations = 1800 + (winner === 0 ? 0 : 180);
                
                coin.style.transform = `rotateY(${rotations}deg)`;
                
                setTimeout(() => {
                    // isFlipping = false; // Keep true to prevent any further clicks
                    console.log("Animation finished.");

                    const winnerName = winner === 0 ? players.p1 : players.p2;
                    GameEngine.setTurn(winnerName); // SAVE TURN

                    const winnerColorClass = winner === 0 ? "text-sky-500" : "text-rose-500";
                    const bgColorClass = winner === 0 ? "bg-sky-500" : "bg-rose-500";
                    
                    statusText.innerText = "Decision made.";
                    resultText.innerHTML = `<span class="${winnerColorClass}">${winnerName}</span> takes the lead!`;
                    if (winnerIndicator) winnerIndicator.className = `w-4 h-4 rounded-full ${bgColorClass} animate-pulse`;
                    
                    if (resultContainer) {
                        resultContainer.classList.remove('opacity-0', 'scale-95');
                        resultContainer.classList.add('opacity-100', 'scale-100');
                    }
                    
                    // Trigger Haptic Feedback simulation
                    if (window.navigator.vibrate) {
                        window.navigator.vibrate([10, 30, 10]);
                    }

                    // AUTO REDIRECT after 2 seconds
                    setTimeout(() => {
                        console.log("Auto-redirecting to draft...");
                        window.location.href = 'cardselect.html';
                    }, 2000);

                }, 3000);
            }
        });
    </script>
</body></html>
